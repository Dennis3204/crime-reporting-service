<main>
    {{#with report}}
        <h1>{{title}}</h1>
        {{#ifEq author ../user.username}}
            <div class="actions">
                <a class="btn" href="/reports/{{_id}}/edit">Edit report</a>
                <a class="btn btn-danger" href="/reports/{{_id}}/delete">Delete report</a>
            </div>
        {{/ifEq}}
        <h2>Details</h2>
        <dl>
            {{#unless is_anonymous}}
                <dt>Author:</dt>
                <dd>{{author}}</dd>
            {{/unless}}
            <dt>Crime type:</dt>
            <dd>{{crime}}</dd>
            <dt>Location:</dt>
            <dd>{{area}}, {{city}}, {{state}} ({{zipcode}})</dd>
            <dt>Created on:</dt>
            <dd>{{created_at}}</dd>
            <dt>Last edited on:</dt>
            <dd>{{edited_at}}</dd>
        </dl>
        <h2>Images</h2>
        {{#each img}}
            <img class="report-img" src="{{this}}" alt="Photo for report '{{../title}}'">
        {{else}}
            <p>No images provided.</p>
        {{/each}}
        <h2>Description</h2>
        <p>{{desc}}</p>
        <h2>Comments</h2>
        {{#if ../user}}
            <form id="comment-form" action="/reports/{{_id}}/comment" method="POST">
                <label for="comment">Leave a comment:</label>
                <textarea id="comment" name="comment" required></textarea>
                <input type="submit" value="Submit">
            </form>
            <p class="error" id="comment-error" hidden="hidden">Error: Comment must contain non-whitespace characters.</p>
        {{/if}}
        <form action="/reports/{{_id}}" method="GET">
            <label for="sort">Sort by:</label>
            <select id="sort" name="sort">
                <option value="best" {{#ifEq ../sort "best"}}selected{{/ifEq}}>Highest score first</option>
                <option value="worst" {{#ifEq ../sort "worst"}}selected{{/ifEq}}>Lowest score first</option>
                <option value="newest" {{#ifEq ../sort "newest"}}selected{{/ifEq}}>Newest first</option>
                <option value="oldest" {{#ifEq ../sort "oldest"}}selected{{/ifEq}}>Oldest first</option>
            </select>
            <input type="submit" value="Sort">
        </form>
        <ul class="comment-list">
            {{#each comments}}
                <li class="comment">
                    <div class="comment-meta">Posted by {{author}} ({{time}})</div>
                    <div class="comment-body">{{comment}}</div>
                    <div class="comment-score">Score: {{score}}</div>
                    {{#if ../../user}}
                        <div class="comment-actions">
                            <form action="/comments/{{_id}}/like" method="POST">
                                <input type="submit" value="Like">
                            </form>
                            <form action="/comments/{{_id}}/dislike" method="POST">
                                <input type="submit" value="Dislike">
                            </form>
                        </div>
                    {{/if}}
                </li>
            {{else}}
                <li>No comments yet.</li>
            {{/each}}
        </ul>
    {{/with}}
</main>
<script type="module" src="/js/report.js"></script>
